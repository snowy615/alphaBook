<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} ‚Äî Poker Auction</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="topbar">
        <a href="/" class="logo">{{ app_name }}</a>
        <div id="loginBox" class="hidden"><a href="/login" class="btn small ghost">Login</a></div>
        <div id="userBox" class="hidden"><span id="userName"></span></div>
    </div>

    <div class="page-container" style="max-width: 780px;">
        <div class="section-card">
            <h2>üÉè Poker Auction</h2>
            <p style="color: var(--muted); margin-bottom: 16px;">
                Bid on poker cards in a multi-round auction. Build the best 5-card hand to win big!
            </p>

            <div class="rules-section">
                <h3>üìã How It Works</h3>
                <ol style="color: var(--text); line-height: 1.8; padding-left: 20px;">
                    <li>Each team starts with <strong>1 random card</strong> and <strong>$1,000</strong></li>
                    <li><strong>13 rounds</strong> of sealed-bid auction ‚Äî a full 52-card deck is auctioned off</li>
                    <li>Highest bidder wins the cards, but <strong>pays the second-highest bid</strong></li>
                    <li>After auctions, you can <strong>sell cards to the host ($20 each)</strong> or <strong>auction
                            them to other teams</strong></li>
                    <li>Form the <strong>best 5-card poker hand</strong> ‚Äî top hand wins <strong>$2,000</strong>! üèÜ
                    </li>
                </ol>
            </div>

            <div class="rules-section">
                <h3>üî® Round Schedule</h3>
                <div style="display:flex;flex-wrap:wrap;gap:6px;margin:8px 0;">
                    <span class="pa-round-badge">R1: 2</span>
                    <span class="pa-round-badge">R2: 3</span>
                    <span class="pa-round-badge">R3: 4</span>
                    <span class="pa-round-badge">R4-10: 5</span>
                    <span class="pa-round-badge">R11: 4</span>
                    <span class="pa-round-badge">R12: 2</span>
                    <span class="pa-round-badge">R13: 2</span>
                </div>
            </div>

            <div class="rules-section">
                <h3>üí∞ Post-Auction</h3>
                <p style="color: var(--text);">
                    After all 13 rounds, you can sell unwanted cards:
                </p>
                <table style="width:100%;margin:8px 0;color:var(--text);font-size:13px;border-collapse:collapse;">
                    <tr style="border-bottom:1px solid var(--border);">
                        <th style="text-align:left;padding:6px;">Option</th>
                        <th style="text-align:left;padding:6px;">Cost/Revenue</th>
                    </tr>
                    <tr>
                        <td style="padding:6px;">Sell to host</td>
                        <td style="padding:6px;">+$20 per card</td>
                    </tr>
                    <tr>
                        <td style="padding:6px;">Auction 1 card</td>
                        <td style="padding:6px;">-$40 listing fee</td>
                    </tr>
                    <tr>
                        <td style="padding:6px;">Auction 2 cards</td>
                        <td style="padding:6px;">-$70 listing fee</td>
                    </tr>
                    <tr>
                        <td style="padding:6px;">Auction 3 cards</td>
                        <td style="padding:6px;">-$90 listing fee</td>
                    </tr>
                    <tr>
                        <td style="padding:6px;">Auction 3+ cards</td>
                        <td style="padding:6px;">-$90 + $10/extra</td>
                    </tr>
                </table>
            </div>

            <div class="rules-section">
                <h3>üèÜ Hand Awards</h3>
                <p style="color: var(--text); margin-bottom: 8px;">
                    Your best 5-card hand earns a fixed bonus:
                </p>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:13px;color:var(--text);">
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(253,203,110,0.1);border-radius:6px;">
                        <span>Royal Flush</span><strong style="color:#00b894;">$2,500</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(253,203,110,0.08);border-radius:6px;">
                        <span>Straight Flush</span><strong style="color:#00b894;">$2,000</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Four of a Kind</span><strong style="color:#00b894;">$1,500</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Full House</span><strong style="color:#00b894;">$1,200</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Flush</span><strong style="color:#00b894;">$1,000</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Straight</span><strong style="color:#00b894;">$800</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Three of a Kind</span><strong style="color:#00b894;">$500</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>Two Pair</span><strong style="color:#00b894;">$300</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>One Pair</span><strong style="color:#00b894;">$100</strong></div>
                    <div
                        style="display:flex;justify-content:space-between;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;">
                        <span>High Card</span><strong style="color:var(--muted);">$0</strong></div>
                </div>
            </div>

            <hr style="border-color: var(--border); margin: 32px 0;">

            <!-- Admin: Create Game -->
            <div id="adminCreate" class="hidden">
                <div class="rules-section" style="border-color: var(--brand);">
                    <h3>üõ†Ô∏è Admin ‚Äî Create Game</h3>
                    <button onclick="createGame()" class="btn" id="createBtn">Create Poker Auction Game</button>
                    <div id="createResult" class="hidden" style="margin-top: 16px; text-align: center;">
                        <p style="margin-bottom: 4px; color: var(--muted); font-size: 13px;">GAME CREATED ‚Äî SHARE THIS
                            CODE</p>
                        <div id="createdCode"
                            style="font-size: 32px; font-weight: 800; letter-spacing: 8px; color: var(--brand); margin: 8px 0;">
                        </div>
                        <a id="createdLink" href="#" class="btn" style="margin-top: 8px;">Go to Game ‚Üí</a>
                    </div>
                </div>
                <hr style="border-color: var(--border); margin: 32px 0;">
            </div>

            <div class="fiveos-join">
                <h3>Join a Game</h3>
                <p>Enter the 6-character code from your game admin:</p>
                <div class="join-form">
                    <input type="text" id="joinCode" placeholder="ABC123" maxlength="6"
                        style="text-transform: uppercase; text-align: center; font-size: 24px; letter-spacing: 8px; padding: 12px 16px; width: 220px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; color: var(--text);">
                    <button onclick="joinGame()" class="btn" id="joinBtn">Join Game</button>
                </div>
                <p id="joinMsg" class="small" style="margin-top: 8px;"></p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>{{ app_name }} ‚Ä¢ Poker Auction</p>
    </div>

    <script>
        (async function () {
            const fetchJSON = async (url, init) => {
                const r = await fetch(url, { credentials: "include", ...init });
                if (!r.ok) throw new Error(String(r.status));
                return r.json();
            };
            try {
                const me = await fetchJSON("/me");
                document.getElementById("loginBox").classList.add("hidden");
                document.getElementById("userBox").classList.remove("hidden");
                document.getElementById("userName").textContent = me.username || "user";
                if (me.is_admin) {
                    document.getElementById("adminCreate").classList.remove("hidden");
                }
            } catch {
                document.getElementById("loginBox").classList.remove("hidden");
                document.getElementById("userBox").classList.add("hidden");
            }
        })();

        async function createGame() {
            const btn = document.getElementById("createBtn");
            btn.disabled = true; btn.textContent = "Creating...";
            try {
                const r = await fetch("/poker-auction/create", {
                    method: "POST", credentials: "include",
                    headers: { "Content-Type": "application/json" },
                    body: "{}",
                });
                const data = await r.json();
                if (r.ok && data.game_id) {
                    document.getElementById("createdCode").textContent = data.join_code;
                    document.getElementById("createdLink").href = `/poker-auction/game/${data.game_id}`;
                    document.getElementById("createResult").classList.remove("hidden");
                    btn.textContent = "‚úÖ Created!";
                } else {
                    btn.textContent = data.detail || "Error";
                    setTimeout(() => { btn.textContent = "Create Poker Auction Game"; btn.disabled = false; }, 2000);
                }
            } catch (e) {
                btn.textContent = "Error";
                setTimeout(() => { btn.textContent = "Create Poker Auction Game"; btn.disabled = false; }, 2000);
            }
        }

        async function joinGame() {
            const code = document.getElementById("joinCode").value.trim();
            const msg = document.getElementById("joinMsg");
            if (!code || code.length < 4) { msg.textContent = "Enter a valid code"; return; }
            try {
                const r = await fetch("/poker-auction/join", {
                    method: "POST", credentials: "include",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ join_code: code }),
                });
                const data = await r.json();
                if (r.ok && data.game_id) {
                    window.location.href = `/poker-auction/game/${data.game_id}`;
                } else {
                    msg.textContent = data.detail || "Could not join"; msg.style.color = "#ff6b6b";
                }
            } catch (e) {
                msg.textContent = "Error joining"; msg.style.color = "#ff6b6b";
            }
        }

        document.getElementById("joinCode").addEventListener("keydown", e => { if (e.key === "Enter") joinGame(); });
    </script>
</body>

</html>