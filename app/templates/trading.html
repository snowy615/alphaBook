<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ symbol }} - {{ app_name }}</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <a href="/" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit;">
        <div class="logo">
          <img src="/static/alphabook.png" alt="AlphaBook" class="logo-img">
        </div>
        <div class="titles">
          <h1>{{ app_name }}</h1>
          <div class="subtitle">Back to Equities</div>
        </div>
      </a>
    </div>
    <div class="actions">
      <div id="loginBox" class="hidden">
        <a href="/login" class="btn">Login</a>
        <a href="/signup" class="btn">Sign up</a>
      </div>
      <div id="userBox" class="hidden">
        <span id="userName">user</span>
        <form method="post" action="/logout" style="display:inline">
          <button type="submit" class="btn ghost">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <div class="container trading-container">
    <!-- Position Summary at Top -->
    <section id="position-summary" class="position-card-simple">
      <div class="position-simple-content">
        <span class="position-label">{{ symbol }} Position</span>
        <span class="position-value" id="pos-qty">0.00</span>
        <span class="position-live">Live</span>
      </div>
    </section>

    <!-- Two Column Layout: Order Book & News -->
    <div class="trading-layout">
      <!-- Left Column: Order Book -->
      <div class="left-column">
        <section class="card order-book-card">
          <div class="head">
            <div class="sym">{{ symbol }}</div>
            <div class="ref" id="ref-{{ symbol }}">--</div>
          </div>
          <div class="meta">
            <span id="meta-{{ symbol }}">waiting for data…</span>
          </div>

          <div class="order-actions">
            <button id="open-order" class="btn primary">Place Order</button>
          </div>

          <table class="ladder" id="ladder-{{ symbol }}">
            <thead>
              <tr>
                <th></th>
                <th>Ask&nbsp;Qty</th>
                <th>Ask&nbsp;Px</th>
                <th class="div">—</th>
                <th>Bid&nbsp;Px</th>
                <th>Bid&nbsp;Qty</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="ladder-body-{{ symbol }}"></tbody>
          </table>
        </section>
      </div>

      <!-- Right Column: Game Instructions + News OR just News -->
      <div class="right-column">
        {% if is_custom_game and game_info %}
        <!-- Game Instructions Card - Collapsible -->
        <section class="card game-info-card" style="margin-bottom: 24px;">
          <div class="head clickable" onclick="toggleInstructions()" style="cursor: pointer;">
            <div class="sym">{{ game_info.name }}</div>
            <div class="expand-icon" id="instructions-icon">▼</div>
          </div>
          <div class="game-instructions" id="game-instructions-content" style="display: none;">
            <h4>Instructions</h4>
            <p>{{ game_info.instructions }}</p>
          </div>
        </section>
        {% endif %}

        <!-- My Orders Card - Fixed height with scroll -->
        <section class="card" id="my-orders-card" style="margin-bottom: 24px;">
          <div class="head">
            <div class="sym">My Orders</div>
          </div>
          <div class="scrollable-content" style="max-height: 300px; overflow-y: auto; padding: 16px;">
            <div id="my-orders-list">
              <div class="small" style="text-align: center; color: var(--muted); padding: 20px;">
                Loading orders...
              </div>
            </div>
          </div>
        </section>

        <!-- Market Updates Card - Fixed height with scroll -->
        <section class="card news-card">
          <div class="head">
            <div class="sym">Market Updates</div>
          </div>
          <div class="news-content scrollable-content" id="news-content" style="max-height: 300px; overflow-y: auto; padding: 16px;">
            <div class="news-item">
              <div class="news-time">Just now</div>
              <div class="news-title">{{ symbol }} Trading Active</div>
              <div class="news-text">Real-time order book data streaming.</div>
            </div>
            <div class="news-item">
              <div class="news-time">5 min ago</div>
              <div class="news-title">Market Open</div>
              <div class="news-text">All equities available for trading.</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Order Modal -->
  <dialog class="modal" id="order-modal">
    <div class="panel">
      <div class="panel-head">
        <h3>Place Order - {{ symbol }}</h3>
        <button class="icon-close" id="close-order">✕</button>
      </div>
      <form id="order-form">
        <div class="panel-body">
          <div class="seg">
            <label><input type="radio" name="side" value="BUY" checked> Buy</label>
            <label><input type="radio" name="side" value="SELL"> Sell</label>
          </div>
          <div class="row-2">
            <div class="field">
              <label>Price</label>
              <input type="number" id="ord-price" step="0.01" required>
            </div>
            <div class="field">
              <label>Quantity</label>
              <input type="number" id="ord-qty" step="1" min="1" required>
            </div>
          </div>
          <div class="small" id="ord-hint"></div>
        </div>
        <div class="panel-foot">
          <button type="button" class="btn ghost" id="cancel-order">Cancel</button>
          <button type="submit" class="btn primary">Submit Order</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- Quick Trade Modal -->
  <dialog class="modal" id="quick-trade-modal">
    <div class="panel">
      <div class="panel-head">
        <h3 id="qt-title">Quick Trade</h3>
        <button class="icon-close" id="qt-close">✕</button>
      </div>
      <div class="panel-body">
        <div class="qt-info">
          <div class="qt-side" id="qt-side-label">BUY</div>
          <div class="qt-symbol" id="qt-symbol">{{ symbol }}</div>
          <div class="qt-price-label">at</div>
          <div class="qt-price" id="qt-price">150.00</div>
        </div>

        <div class="field">
          <label>Quantity: <span id="qt-qty-display">1</span></label>
          <input type="range" id="qt-qty-slider" min="1" max="100" value="1" step="1">
          <div class="slider-labels">
            <span>1</span>
            <span>50</span>
            <span>100</span>
          </div>
        </div>

        <div class="qt-summary">
          <div class="qt-summary-row">
            <span>Notional:</span>
            <span id="qt-notional">$150.00</span>
          </div>
        </div>

        <div class="small" id="qt-hint"></div>
      </div>
      <div class="panel-foot">
        <button type="button" class="btn ghost" id="qt-cancel">Cancel</button>
        <button type="button" class="btn primary" id="qt-submit">Submit Order</button>
      </div>
    </div>
  </dialog>

  <div class="footer">
    <p>{{ app_name }} • {{ symbol }} Trading</p>
  </div>

  <script>
    window.SYMBOL = "{{ symbol }}";
    window.TOP_DEPTH = {{ depth }};
  </script>
  <script src="/static/trading.js"></script>
</body>
</html>