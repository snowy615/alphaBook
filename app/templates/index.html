<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ app_name }}</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="logo">α</div>
      <div class="titles">
        <h1>{{ app_name }}</h1>
        <div class="subtitle">Real-time Order Book</div>
      </div>
    </div>
    <div class="actions">
      <div id="loginBox" class="hidden">
        <a href="/login" class="btn">Login</a>
        <a href="/signup" class="btn">Sign up</a>
      </div>
      <div id="userBox" class="hidden">
        <span id="userName">user</span>
        <button id="open-order" class="btn primary">Place Order</button>
        <form method="post" action="/logout" style="display:inline">
          <button type="submit" class="btn ghost">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Enhanced Account Section -->
    <section id="account" class="hidden">
      <div class="account-header">
        <h2>Account Overview</h2>
        <div class="account-meta" id="account-meta">Live</div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Position Qty</div>
          <div class="stat-value" id="pos-qty">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Cost</div>
          <div class="stat-value" id="pos-avg">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Notional</div>
          <div class="stat-value" id="pos-notional">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Delta</div>
          <div class="stat-value" id="pos-delta">--</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label">Open P&L</div>
          <div class="stat-value" id="pnl-open">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Day P&L</div>
          <div class="stat-value" id="pnl-day">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Cash</div>
          <div class="stat-value" id="cash">--</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label">Equity</div>
          <div class="stat-value" id="equity">--</div>
        </div>
      </div>

      <div class="chart-container">
        <h3>P&L Chart</h3>
        <canvas id="pnlChart"></canvas>
      </div>
    </section>

    <!-- My Open Orders Section -->
    <section id="orders-panel" class="card hidden" style="margin-top: 24px;">
      <div class="head">
        <div class="sym">My Open Orders (<span id="orders-count">0</span>)</div>
        <div class="meta">
          <span id="orders-meta">loading...</span>
        </div>
      </div>
      <div class="table-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Side</th>
              <th>Symbol</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Filled</th>
              <th>Remaining</th>
              <th>Status</th>
              <th>Created</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="orders-body"></tbody>
        </table>
      </div>
    </section>

    <!-- Order Book Grid -->
    <div class="toolbar">
      <div class="status">
        <div class="dot pulse"></div>
        <span>Live Market Data</span>
      </div>
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <!-- Order Modal -->
  <dialog class="modal" id="order-modal">
    <div class="panel">
      <div class="panel-head">
        <h3>Place Order</h3>
        <button class="icon-close" id="close-order">✕</button>
      </div>
      <form id="order-form">
        <div class="panel-body">
          <div class="field">
            <label>Symbol</label>
            <select id="ord-symbol" required>
              <option value="">Select symbol</option>
            </select>
          </div>
          <div class="seg">
            <label><input type="radio" name="side" value="BUY" checked> Buy</label>
            <label><input type="radio" name="side" value="SELL"> Sell</label>
          </div>
          <div class="row-2">
            <div class="field">
              <label>Price</label>
              <input type="number" id="ord-price" step="0.01" required>
            </div>
            <div class="field">
              <label>Quantity</label>
              <input type="number" id="ord-qty" step="1" min="1" required>
            </div>
          </div>
          <div class="small" id="ord-hint"></div>
        </div>
        <div class="panel-foot">
          <button type="button" class="btn ghost" id="cancel-order">Cancel</button>
          <button type="submit" class="btn primary">Submit Order</button>
        </div>
      </form>
    </div>
  </dialog>

  <div class="footer">
    <p>{{ app_name }} • Demo Order Book Platform</p>
  </div>

  <script>
    window.SYMBOLS = {{ symbols_json|safe }};
    window.TOP_DEPTH = {{ depth }};
  </script>
  <script src="/static/app.js"></script>
</body>
</html>